# Assignment 3

## System Information Web Server Setup

We are setting up a Bash script that generates a static `index.html` file containing system information. The script will run automatically every day at 05:00 using a systemd service and timer. The HTML document generated by this script will be served with the nginx web server, and a firewall will be configured using UFW to secure the server.

This project willinclude:

- Scripting
- System administration (user and permission management)
- Working with systemd timers and services
- Configuring and managing Nginx web server
- Setting up a firewall using UFW

---

## Task 1: Create a System User (`webgen`)

1. **Create a system user** called `webgen` with a home directory at `/var/lib/webgen` and a non-login shell.
2. Ensure that the user has ownership of the home directory and all its files.

Creating a system user is more secure than using a regular user or root. It ensures that the user does not have login capabilities, which reduces the risk of unauthorized access. System users are  run background services, and by limiting their permissions, we can reduce the chance of malicious or accidental changes to the system.


---

## Task 2: Create a systemd Service and Timer

1. **Create a systemd service** called `generate-index.service` that runs the `generate_index` script.
2. Ensure the service runs as the `webgen` user and group, when the network is online 
3. **Create a timer** (`generate-index.timer`) to run the service daily at 05:00.


We can verify the status of the timer and service with the following commands:

- `sudo systemctl status generate-index.timer` – Check if the timer is active.
- `sudo systemctl start generate-index.service` – Start the service manually.
- `sudo systemctl status generate-index.service` – Verify the status of the service.
- `sudo journalctl -u generate-index.service` – View logs related to the service execution.

These commands will ensure that the timer and service are functioning correctly.

---

## Task 3: Configure Nginx

1. **Modify the nginx configuration** to ensure the server runs as the `webgen` user.
2. **Create a separate server block file** for serving the `index.html` file on port 80, instead of modifying the main `nginx.conf` directly.

**Why is it important to use a separate server block file instead of modifying the main nginx.conf file directly?**

Using a separate server block file helps keep the configuration organized. It allows easy management of individual server configurations, so that it is easier to troubleshoot. It also follows best practices, making the system more maintainable and scalable.

To check the status of nginx:

- `sudo systemctl status nginx` – Verify if nginx is running.
- `sudo nginx -t` – Test the nginx configuration for syntax errors.
- `sudo systemctl reload nginx` – Reload nginx after configuration changes.

These commands help ensure that nginx is functioning as expected and the configuration is correct.

---

## Task 4: Set up a Firewall with UFW

1. **Install UFW** and configure it to:
   - Allow SSH and HTTP from anywhere 
   - Enable SSH rate limiting to protect against brute-force attacks.

To check the status of your firewall:

- `sudo ufw status verbose` – This command will show detailed information about the firewall status and active rules.

---
Note: Unfortunately I ran into some issues in this step and was unable to properly configure the firewall. I kept getting the error: 
`Job for nftables.service failed because the control process exited with error code.
See "systemctl status nftables.service" and "journalctl -xeu nftables.service" for details.`

I tried troubleshooting, butI just kept getting blocked and running into the same error over and over again. Everything else seems to be working fine in the nginx.config file as well as the server_block. I was also able to install ufw. The issue occured when it came time to the command `sudo ufw allow http` and `sudo ufw allow http`. As a result everytime I try to go to http://154.20.162.135/ (my Ip address) I get a "This site can't be reached error".

Some ways we can enhance the generate_index step include:
- Adding more system information such as CPU usage, memory usage, disk space, and uptime.
- Implementing error handling to catch issues like missing dependencies, permissions errors, or failed script execution. For example, you can add logging or email notifications in case of errors.

---


The following scripts are in the git repository: 
1. The `generate_index` script.
2. The `generate-index.service` file.
3. The `generate-index.timer` file.
4. The `nginx.conf` file (modified for the `webgen` user).
5. The server_block configuration file for nginx.


### Instructions for Setup:
- Clone the repository to your server.
- Place the necessary files in the appropriate locations:
  - `generate_index` script in `/var/lib/webgen/bin/`.
  - The nginx server block configuration in `/etc/nginx/sites-available/` and create a symlink in `/etc/nginx/sites-enabled/`.
- Create the systemd service and timer files in `/etc/systemd/system/`.
- Enable and start the systemd timer with:  
  `sudo systemctl enable generate-index.timer`  
  `sudo systemctl start generate-index.timer`
- Ensure nginx is installed and running:
  - Test configuration with `sudo nginx -t`.
  - Reload nginx with `sudo systemctl reload nginx`.
- Configure UFW to allow SSH and HTTP:
  - `sudo ufw allow ssh`
  - `sudo ufw allow http`
  - `sudo ufw enable`

This will set up the server with all necessary configurations to run the script daily and serve the system information.

---

